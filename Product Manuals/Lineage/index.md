---
title: "Lineage"
---
# Lineage

FastScore Lineage is a service that intercepts various internally generated events for the purposes of tracking the history of what has happened to various assets within FastScore.  Lineage provides REST APIs for accessing information concerning specific events and assets, as well as for tracking various pieces of metadata associated with each.

### Events

Metadata events are generated by the various FastScore components (currently Model-Manage and Engine).  Events include things like adding a model, schema, or stream descriptor to Model-Manage, loading a model or stream descriptor into an Engine, as well as the various Engine state transitions.

Events are published as a JSON object that contain:

* A description: a brief description of the event ('put model: model1.py')
* A type: an arbitrary string that allows events to be grouped ('attach stream')
* An array of 'elements'
* A map of 'tags'

Elements consist of:

* A description: typically the name of the element ('model1')
* A type: an arbitrary string that allows elements to be grouped ('schema')
* An array of 'tags'

Tags are simply a map of key/value pairs that become associated with the enclosing event or element

Here's an example of what a well-formed event might look like:

```
{
  "description" : "put model: model1",
  "type" : "put model",
  "elements" : [
    {
      "description" : "model1",
      "type" : "model",
      "tags" : {
        "model-hash" : "abcd1234"
      }
    },
    {
      "description" : "model-manage",
      "type" : "fastscore-service",
    }
  ],
  "tags" : {
    "timestamp" : "5:15"
  }
}
```

Events arrive at Lineage via Pneumo, the FastScore internal communication system.  As such, they can be viewed via the CLI `pneumo` command.

## Retrieval APIs

### lineage/1/element_types

Returns an array of the various element types that have associated events.

Example output:

```
[
  "fastscore-service",
  "model",
  "schema",
  "stream"
]
```

### lineage/1/elements

Returns an array of each element, including the description, type and the id of the element.  The id of the element can be used to get more information about that specific element using the 'lineage/1/elements/[id]' API.

```
[
  {
    "description": "discard",
    "id": 1367,
    "type": "stream"
  },
  {
    "description": "model-manage-1",
    "id": 325,
    "type": "fastscore-service"
  },
  {
    "description": "yield1234-py",
    "id": 863,
    "type": "model"
  }
]
```

This results can be filtered by element type by using '?element_type=[type]', where 'type' is from the array returned from /1/element_types.

### lineage/1/elements/[id]

Returns a detailed view of element specified by the [id].

```
{
  "description": "yield1234-py",
  "id": 863,
  "type": "model",
  "events": [
    {
      "description": "put model: yield1234-py",
      "id": 839,
      "timestamp": "2018-12-12T21:35:23.685Z",
      "type": "put model"
    }
  ],
  "tags": {
    "model-hash": "4b8558b70f5162d27a5f36f652999c5f",
    "model-type": "Python"
  }
}
```

Note that the returned JSON object has an array of events, each of which involved the specified element.

Additionally, the 'tags' at the end of the element contain only the most recent value associated with any particular key.

### lineage/1/events

Returns a list of all the events that lineage has tracked.

```
[
  {
    "description": "put model: EchoJava-java",
    "id": 262,
    "timestamp": "2018-12-12T21:35:22.456Z",
    "type": "put model"
  },
  {
    "description": "put model: echo-array-double-py",
    "id": 341,
    "timestamp": "2018-12-12T21:35:22.552Z",
    "type": "put model"
  },
  {
    "description": "put model: echo-array-double-py3",
    "id": 415,
    "timestamp": "2018-12-12T21:35:22.641Z",
    "type": "put model"
  }
]
```

Note that the timestamp indicates the time that Lineage saw the event and persisted it in the configured backend.

### lineage/1/events/[id]

Returns a detailed view of the event specified by [id]

```
{
  "description": "put model: echo-array-double-py3",
  "id": 415,
  "timestamp": "2018-12-12T21:35:22.641Z",
  "type": "put model",
  "elements": [
    {
      "description": "echo-array-double-py3",
      "id": 439,
      "type": "model",
      "tags": [
        {
          "id": 452,
          "key": "model-type",
          "value": "Python3"
        },
        {
          "id": 465,
          "key": "model-hash",
          "value": "278263485a0d64b1edc83c4c30c90fc7"
        }
      ]
    },
    {
      "description": "model-manage-1",
      "id": 325,
      "type": "fastscore-service"
    }
  ],
  "tags": [
    {
      "id": 423,
      "key": "pneumo-timestamp",
      "value": "2018-12-12T21:35:21.613138Z"
    }
  ]
}
```

In many respects, this will look quite similar to the event that was received and injected into Lineage.  The main differences are that the event itself, as well as each element and tag, contain an id.  Since the tags' ids are displayed, tags are no longer represented as a map, but rather as an array of JSON objects.

### lineage/1/tags

Returns a list of all the tags

```
[
  {
    "id": 539,
    "key": "model-hash",
    "value": "a9cd0d2191df64bb1e77d27a9881e827"
  },
  {
    "id": 1136,
    "key": "schema-hash",
    "value": "13f4e51ec271c78a3056c9eed8eef668"
  },
  {
    "id": 571,
    "key": "pneumo-timestamp",
    "value": "2018-12-12T21:35:22.285562Z"
  }
]
```

### lineage/1/tags/[id]

Returns details concerning a specific tag

```
{
  "id": 452,
  "key": "model-type",
  "value": "Python3",
  "elements": [
    {
      "description": "echo-array-double-py3",
      "id": 439,
      "type": "model"
    },
    {
      "description": "emit-attach1-py3",
      "id": 725,
      "type": "model"
    },
    {
      "description": "echo-py3",
      "id": 656,
      "type": "model"
    }
  ]
}
```

Note that a tag can be associated with 0 or more elements as well as 0 or more events.  In the example above, the 'model-type:Python3' key/value pair is associated only with elements, but a brief description of each (including their ids) is included.




## Starting Model Deploy

Start Model Deploy with the following command:
```
docker run -it --rm -p 8888:8888 fastscore/model-deploy:latest
```
If other services in the FastScore fleet are also running on the same host, it may be advantageous to start Model Deploy with the `--net="host"` option, so that these services are accessible from `localhost`. 

Model Deploy may also be started with any of the additional configuration options available to the Jupyter base Docker image, [see the documentation for more details](https://github.com/jupyter/docker-stacks/tree/master/datascience-notebook). 

Once the container is created, it will be accessible from port 8888 (by default) on the host machine, using the token generated during the startup process. 

## Model Deploy functionality

Model Deploy provides a number of features to make it easy to migrate a model into FastScore:

* Python and R supply a `Model` class that can be used for validation and testing of a model locally, before deploying to a FastScore engine.
* The `Model.from_string` (Python) and `Model_from_string` (R) functions provide shortcuts for creating a Model object from a string of code. In Python notebooks, the `%%py2model`, `%%py3model`, `%%pfamodel`, and `%%ppfamodel` cell magic commands will automatically convert the contents of a cell into a Python or (P)PFA model object, respectively.
* The `Engine` class allows for direct interaction with a FastScore Engine, including scoring data using a running Engine
* `Model` objects may be deployed directly to a FastScore Engine from within the Jupyter notebook, as well as to Model Manage.
* A utility `codec` library is included to make it easy to serialize R and Python objects to JSON and other formats based on an Avro schema.

Example notebooks demonstrating this functionality are included with the Model Deploy container.
